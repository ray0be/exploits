# CVE-2013-1362

> Disclaimer: For educational purposes only.

This exploit allows a script on machine A to execute arbitrary code on machine B. Based on this exploit :

 - https://www.exploit-db.com/exploits/24955
 - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/misc/nagios_nrpe_arguments.rb

Written as a Python class and improved so that we can test if a host is vulnerable and get the output of the remotely executed script (it becomes easy to read a remote file, for instance, or execute an entire script).

Requirements :

 - Machine A :
   - **check_nrpe** must be installed (in `/usr/local/nagios/libexec/`) ;
   - must be in the network allowed by machine B to perform NRPE requests ;
 - Machine B :
   - NRPE **before v2.14** must be installed ;
   - NRPE must be compiled with the "--enable-command-args" option : `./configure --libexecdir=/usr/local/nagios/libexec/ --bindir=/usr/local/nagios/bin/ --prefix=/usr/local/nagios --enable-command-args` ;
   - An authorization must be given to user *nagios* to execute any command on behalf of the *root* user without password (in `/etc/sudoers`) : `nagios ALL=(ALL) NOPASSWD: ALL` ;
   - NRPE must be configured (`/usr/local/nagios/etc/nrpe.cfg`) to allow a certain range of IPs to trigger NRPE commands (allowed_hosts), to enable command-line arguments to be provided to remote plugins (dont_blame_nrpe) and to prefix commands with *sudo* (command_prefix). And finally, **check_users** or **check_procs** command must include arguments in their definition :
```txt
allowed_hosts=127.0.0.1,10.0.0.0/16
dont_blame_nrpe=1
command_prefix=/usr/bin/sudo

command[check_users]=/usr/local/nagios/libexec/check_users -w $ARG1$ -c $ARG2$
```

When trying to execute something remotely, you must always call the `check_target()` method first because it saves the vulnerable command to use later.

The script is not very flexible, as is, but it's not that much difficult to edit if there is a need, let's say, to execute a script without root permissions.
